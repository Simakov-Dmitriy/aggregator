$(document).ready(function () { var t, e, a, i, l, c, s; for (t = document.getElementsByClassName("custom-select"), e = 0; e < t.length; e++) { for (i = t[e].getElementsByTagName("select")[0], (l = document.createElement("DIV")).setAttribute("class", "select-selected"), l.innerHTML = i.options[i.selectedIndex].innerHTML, t[e].appendChild(l), (c = document.createElement("DIV")).setAttribute("class", "select-items select-hide"), a = 1; a < i.length; a++)s = document.createElement("a"), $(".section-3").hasClass("city-2") ? s.setAttribute("href", "http://aggregatorcore-dev.us-west-2.elasticbeanstalk.com/") : $(".section-3").hasClass("city-1") ? s.setAttribute("href", "http://aggregatorcore-dev.us-west-2.elasticbeanstalk.com/Home/Augustine") : "St. Augustine FL" == $("#chosen-city").text() ? s.setAttribute("href", "http://aggregatorcore-dev.us-west-2.elasticbeanstalk.com/Home/Basket?Chicago") : s.setAttribute("href", "http://aggregatorcore-dev.us-west-2.elasticbeanstalk.com/Home/Basket?St-Augustine"), s.innerHTML = i.options[a].innerHTML, c.appendChild(s); t[e].appendChild(c), l.addEventListener("click", function (t) { t.stopPropagation(), d(this), this.nextSibling.classList.toggle("select-hide"), this.classList.toggle("select-arrow-active") }) } function d(t) { var e, a, i, l = []; for (e = document.getElementsByClassName("select-items"), a = document.getElementsByClassName("select-selected"), i = 0; i < a.length; i++)t == a[i] ? l.push(i) : a[i].classList.remove("select-arrow-active"); for (i = 0; i < e.length; i++)l.indexOf(i) && e[i].classList.add("select-hide") } function n() { $("#basket-modal").addClass("body-modal-wrap-unactive").fadeOut(), $("#delete-modal").addClass("body-modal-wrap-unactive").fadeOut(), $("#sale-modal").addClass("body-modal-wrap-unactive").fadeOut(), $(".modal-faded").remove() } function o(t) { return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase()) } document.addEventListener("click", d), $(".menu-btn").click(function () { $(".menu-wrap").removeClass("menu-unactive") }), $(".menu-back-btn").click(function () { $(".menu-wrap").addClass("menu-unactive") }), $(document).on("click", function (t) { t.target != $(".body-modal-wrap")[0] && t.target != $(".body-modal-wrap")[1] || n() }), $("#close-index-modal").on("click", function (t) { t.preventDefault(), n() }), -1 !== window.location.href.indexOf("Chicago") ? ($("#chosen-city").text("Chicago IL"), $(".top-header-select option:last-child").val("St. Augustine FL"), $(".top-header-select option:last-child").text("St. Augustine FL"), $(".top-header-select option:first-child").val("Chicago IL"), $(".top-header-select option:first-child").text("Chicago IL"), $(".mobile-title").text("CHICAGO")) : ($("#chosen-city").text("St. Augustine FL"), $(".top-header-select option:first-child").val("St. Augustine FL"), $(".top-header-select option:first-child").text("St. Augustine FL"), $(".top-header-select option:last-child").val("Chicago IL"), $(".top-header-select option:last-child").text("Chicago IL"), $(".mobile-title").text("ST AUGUSTINE")), $(".top-header-select").change(function () { $("#chosen-city").text($(this).val()) }), 0 != $("#payment-modal-slider").length && $("#payment-modal-slider").slick({ slidesToShow: 1, arrows: !1, dots: !1, draggable: !1, infinite: !1 }), $("#basket-c-next").on("click", function (t) { t.preventDefault(), "" !== $("#UserInfo_Name").val() && "" !== $("#UserInfo_Surname").val() && "" !== $("#UserInfo_Phone").val() && "" !== $(".phone-number").val() ? o($("#UserInfo_Email").val()) ? ($("#b-modal-warn").css("opacity", 0), $("#payment-modal-slider").slick("slickNext")) : $("#b-modal-warn").text("Íåêîððåêòíûé email") : $("#b-modal-warn").css("opacity", 1) }); for (var r in k) r + ";"; $("#q-cancel").on("click", function () { n() }); let u = 0; function b() { u = 0, count = 0, discount = 0, total = 0, salesTax = 0, subTotal = 0, amountQty = 0; let t = 0; for (let e = 2; e < $(".b-table > div").length + 1; e++)count = +$(".b-table > div:nth-child(" + e + ") >  div:nth-child(3)").find(".b-table-q-number").text(), u = +$(".b-table > div:nth-child(" + e + ") >  div:nth-child(4)").text().slice(1, 6), discount = +$(".b-table > div:nth-child(" + e + ") >  div:nth-child(5)").text().slice(1, 7), subTotal += count * u - count * discount, amountQty += count, $(".b-table > div:nth-child(" + e + ") >  div:nth-child(4)").text("$" + discount.toFixed(2)), t = count * u - count * discount, $(".b-table > div:nth-child(" + e + ") >  div:nth-child(4)").text("$" + u.toFixed(2)), $(".b-table > div:nth-child(" + e + ") >  div:nth-child(5)").text("$" + discount.toFixed(2)), $(".b-table > div:nth-child(" + e + ") >  div:nth-child(6)").text("$" + t.toFixed(2)); $(".sup-checkes-flex input").eq(0).prop("checked") && (subTotal += 20 * amountQty), $(".ins-checkes-flex input").eq(0).prop("checked") && (subTotal += 2 * amountQty), salesTax = 10.25 * subTotal / 100, total = subTotal + salesTax, $("#basket-p-subtotal").text(subTotal.toFixed(2)), $("#basket-p-sale").text(salesTax.toFixed(2)), $("#basket-p-total").text(total.toFixed(2)) } function h() { b(); let t = 0; if ($(".audio-checkes input").eq(0).prop("checked")) { for (let e = 2; e < $(".b-table div").length; e++)-1 === $(".b-table > div:nth-child(" + e + ") > div:first-child").text().indexOf("Medieval") && -1 === $(".b-table > div:nth-child(" + e + ") > div:first-child").text().indexOf("MEDIEVAL") || t++; subTotal += 1.99 * t, salesTax = 10.25 * subTotal / 100, total = subTotal + salesTax, $("#basket-p-subtotal").text(subTotal.toFixed(2)), $("#basket-p-sale").text(salesTax.toFixed(2)), $("#basket-p-total").text(total.toFixed(2)) } } count = 0, discount = 0, total = 0, salesTax = 0, subTotal = 0, amountQty = 0, setTimeout(function () { b() }, 500); var g = $(".top-header-select option:selected").text(); $(".top-header-select").change(function () { -1 != g.indexOf("Chicago") ? ($("#chosen-city").text("Chicago IL"), $("#City").val("Chicago")) : ($("#chosen-city").text("St. Augustine FL"), $("#City").val("Augistine")) }), $('.b-checkes-flex input[type="radio"]').change(function () { h() }); var v = ""; $(document).on("click", ".b-table-q-btn", function () { console.log(JSON.parse(localStorage.getItem("cardData"))); $(this); var t = Number($(this).siblings(".b-table-q-number").text()), e = $(this).parent().attr("qid"), a = $(this).parent().attr("qtype"); 1 == $(this).attr("tq") ? ($(this).siblings(".b-table-q-number").text(++t), $(".top-header-cart-counter").text(Number($(".top-header-cart-counter").text()) + 1), k[e][a] = t) : t > 1 ? ($(this).siblings(".b-table-q-number").text(--t), $(".top-header-cart-counter").text(Number($(".top-header-cart-counter").text()) - 1), k[e][a] = t) : function (t) { $(t).removeClass("body-modal-wrap-unactive").hide().fadeIn(), $("body").append("<div class='modal-faded'>") }("#delete-modal"), h($(this).parent().parent().index()), localStorage.cardData = JSON.stringify(k) }); let m = 0; function f() { let t = !0; setTimeout(function () { "" !== $("#UserInfo_Name").val() && "" !== $("#UserInfo_Surname").val() && -1 == $(".phone-number").val().indexOf("_") && "" !== $(".phone-number").val() ? o($("#UserInfo_Email").val()) ? t = !0 : (t = !1, $(".slick-track > div:first-child .green-btn").css("background", "lightgray"), $(".slick-track > div:first-child .green-btn").attr("disabled", "disabled")) : (console.log($(".phone-number").val()), t = !1, $(".slick-track > div:first-child .green-btn").css("background", "lightgray"), $(".slick-track > div:first-child .green-btn").attr("disabled", "disabled")), t && ($(".slick-track > div:first-child .green-btn").css("background", "#64bb39"), $(".slick-track > div:first-child .green-btn").removeAttr("disabled")) }, 50) } $(".slick-track > div:last-child .b-input").on("input", function () { let t = !0; $("#txtCardNumber").val().length < $("#txtCardNumber").attr("maxlength") && (t = !1, $(".slick-track > div:last-child .green-btn").css("background", "lightgray"), $(".slick-track > div:last-child .green-btn").attr("disabled", "disabled")), $("#txtDate").val().length < 5 && (t = !1, $(".slick-track > div:last-child .green-btn").css("background", "lightgray"), $(".slick-track > div:last-child .green-btn").attr("disabled", "disabled")), $("#textCvv").val().length < +$("#textCvv").attr("maxlength") && (t = !1, $(".slick-track > div:last-child .green-btn").css("background", "lightgray"), $(".slick-track > div:last-child .green-btn").attr("disabled", "disabled")), $("#textZip").val().length < 5 && (t = !1, $(".slick-track > div:last-child .green-btn").css("background", "lightgray"), $(".slick-track > div:last-child .green-btn").attr("disabled", "disabled")), t && ($(".slick-track > div:last-child .green-btn").css("background", "#64bb39"), $(".slick-track > div:last-child .green-btn").removeAttr("disabled")) }), $(".slick-track > div:first-child .b-input").on("input", f), $(".slick-track > div:first-child .b-input").on("change", f), $(document).on("keydown", f), $(".select-items").on("click", function () { "St. Augistine" == $(".same-as-selected").text() && ($(".b-table > div:not(:first-child)").remove(), p = "Chicago", x.city = "Chicago", url = "GetTikets?ñity=" + p + "&PromoCode=" + v, S(), k = JSON.parse(localStorage.getItem("cardData1")), $("#City").val("Chicago"), localStorage.setItem("currentCity", JSON.stringify(x))), "Chicago" == $(".same-as-selected").text() && ($(".b-table > div:not(:first-child)").remove(), p = "Augistine", x.city = "Augistine", url = "GetTikets?ñity=" + p + "&PromoCode=" + v, S(), $(".top-header-cart-counter").text(localStorage.getItem("cartCounter2")), $("#City").val("Augistine"), localStorage.setItem("currentCity", JSON.stringify(x))) }); var p = "Chicago", k = {}, x = {}, y = window.location.href; function C() { x = JSON.parse(localStorage.getItem("currentCity")), k = JSON.parse(localStorage.getItem("cardData1")), "Augistine" == x.city && ($(".select-items div").click(), k = JSON.parse(localStorage.getItem("cardData2"))), url = "GetTikets?ñity=" + x.city + "&PromoCode=" + v, S() } function S() { $.ajax({ type: "POST", url: url, contentType: "application/json; charset=utf-8", dataType: "json", success: function (t) { var e = 0; "Chicago" == $("#City").val() && (k = JSON.parse(localStorage.getItem("cardData1"))), "Augistine" == $("#City").val() && (k = JSON.parse(localStorage.getItem("cardData2"))), "Augistine" == x.city && (k = JSON.parse(localStorage.getItem("cardData2"))); for (var a = 0; a < t.length; a++) { e += k[t[a].id].adult + k[t[a].id].child, k[t[a].id].adult > 0 && (m = t[a].discount + t[a].adultSale, $(".b-table").append('\n                    <div>\n                        <div class="ticket-name">' + t[a].text + '</div>\n                        <div>Adult</div>\n                        <div class="d-flex b-table-q-wrap" qtype="adult" qid="' + t[a].id + '"><div class="b-table-q-btn" tq="0" onclick="removeTicket(event)">-</div><div class="b-table-q-number">' + k[t[a].id].adult + '</div><div class="b-table-q-btn" tq="1">+</div></div>\n                        <div>$ ' + t[a].adultCost + '</div>\n                        <div class="b-table-green">$ ' + m + "</div>\n                        <div>$ " + k[t[a].id].adult * (t[a].adultCost - t[a].sale) + "</div>\n                    </div>\n                    ")), k[t[a].id].child > 0 && (m = t[a].discount + t[a].adultSale, $(".b-table").append('\n                    <div>\n                        <div class="ticket-name">' + t[a].text + '</div>\n                        <div>Child</div>\n                        <div class="d-flex b-table-q-wrap" qtype="child" qid="' + t[a].id + '"><div class="b-table-q-btn" tq="0" onclick="removeTicket(event)">-</div><div class="b-table-q-number">' + k[t[a].id].child + '</div><div class="b-table-q-btn" tq="1">+</div></div>\n                        <div>$ ' + t[a].childCost + '</div>\n                        <div class="b-table-green">$  ' + m + "</div>\n                        <div>$ " + k[t[a].id].child * (t[a].childCost - t[a].sale) + "</div>\n                    </div>\n                    ")); t[a]; if ("Augistine" != p) { if (k["f85d41b3-6abc-4887-929c-5afc8a45f2f6"].adult > 0 || k["f85d41b3-6abc-4887-929c-5afc8a45f2f6"].child > 0 || k["bac57114-9277-457c-accd-06f8f09470d1"].adult > 0 || k["bac57114-9277-457c-accd-06f8f09470d1"].child > 0 || k["8dc10747-ac92-4d1f-9ba5-c4bf21c21b3f"].adult > 0 || k["8dc10747-ac92-4d1f-9ba5-c4bf21c21b3f"].child > 0) { $(".audio-gide")[0].style.display = "" } } else if (k["f85d41b3-6abc-4887-929c-5afc8a45f2f6"].adult > 0 || k["f85d41b3-6abc-4887-929c-5afc8a45f2f6"].child > 0 || k["8838d436-357c-43fa-addb-4a4f8ec224a2"].adult > 0 || k["8838d436-357c-43fa-addb-4a4f8ec224a2"].child > 0) { $(".audio-gide")[0].style.display = "" } } $("#basket-p-subtotal").text(0), $("#basket-p-total").text(0), $("#basket-c-amount").val(0), h($(this).parent().parent().index()), $(".top-header-cart-counter").text(e) }, failure: function (t) { alert(t.id) } }) } -1 != y.indexOf("Chicago") && (p = "Chicago", url = "GetTikets?ñity=" + p + "&PromoCode=" + v, k = JSON.parse(localStorage.getItem("cardData1")), x.city = "Chicago", localStorage.setItem("currentCity", JSON.stringify(x)), $(".top-header-cart-counter").text(localStorage.getItem("cartCounter1")), $("#City").val("Chicago"), S()), -1 != y.indexOf("St-Augustine") && (p = "Augistine", $(".select-items div").click(), url = "GetTikets?ñity=" + p + "&PromoCode=" + v, k = JSON.parse(localStorage.getItem("cardData2")), x.city = "Augistine", localStorage.setItem("currentCity", JSON.stringify(x)), $(".top-header-cart-counter").text(localStorage.getItem("cartCounter2")), $("#City").val("Augistine"), S()), $("#messegesModal").on("hidden.bs.modal", function () { C() }), $(".select-items").on("click", function (t) { "St. Augistine" == $(".same-as-selected").text() && (cityName = "Chicago"), "Chicago" == $(".same-as-selected").text() && (cityName = "St-Augustine") }), $("#messegesModal .red-btn-cancel,#messegesModal .close").click(function () { $("#messegesModal").hide(), $(".modal-backdrop").remove(), $("body").removeClass("modal-open"), C() }) });